# Environment configuration
# 'local' = Skaffold local development (no registry prefix)
# 'production' = ArgoCD with GitLab Registry
environment: local

# Registry configuration (only used when environment: production)
registry:
  url: gitlab-registry.gitlab.svc.cluster.local:5000
  # ImagePullSecret name (created by scripts/setup/02-create-registry-secret.sh)
  imagePullSecret: gitlab-registry-secret

# Image configurations
fastapi:
  image: coelho-realtime-fastapi
  imagePullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      memory: "512Mi"
      cpu: "300m"
    limits:
      memory: "1536Mi"
      cpu: "750m"
  portsSettings:
    ports:
      - name: http
        port: 8000
        targetPort: 8000
        protocol: TCP
    type: LoadBalancer #ClusterIP
  livenessProbeSettings:
    livenessProbe:
      httpGet:
        path: /health
        port: 8000
      initialDelaySeconds: 60  # Wait 1 minute for startup
      periodSeconds: 30      # Check every 30 seconds
      failureThreshold: 3    # Restart after 3 failures (90 seconds of unresponsiveness)


kafka:
  image: coelho-realtime-kafka
  imagePullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  portsSettings:
    ports:
      - name: external
        port: 9092
        targetPort: 9092
        protocol: TCP
      - name: internal
        port: 29092
        targetPort: 29092
        protocol: TCP
      - name: controller
        port: 9093
        targetPort: 9093
        protocol: TCP
    type: LoadBalancer #ClusterIP
  storageSize: 2Gi
  storageClassName: local-path
  livenessProbeSettings:
    livenessProbe:
      tcpSocket:
        port: 29092
      initialDelaySeconds: 90
      periodSeconds: 30
      failureThreshold: 5
  readinessProbeSettings:
    readinessProbe:
      tcpSocket:
        port: 29092
      initialDelaySeconds: 60
      periodSeconds: 10
      failureThreshold: 6


mlflow:
  image: coelho-realtime-mlflow
  imagePullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  portsSettings:
    ports:
      - name: http
        port: 5000
        targetPort: 5000
        protocol: TCP
    type: LoadBalancer #ClusterIP
  livenessProbeSettings:
    livenessProbe:
      httpGet:
        path: /health
        port: 5000
      initialDelaySeconds: 30
      periodSeconds: 15
      timeoutSeconds: 30
      failureThreshold: 5
  readinessProbeSettings:
    readinessProbe:
      httpGet:
        path: /health
        port: 5000
      initialDelaySeconds: 30
      periodSeconds: 15
      timeoutSeconds: 30
      failureThreshold: 5

streamlit:
  image: coelho-realtime-streamlit
  imagePullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "125m"
    limits:
      memory: "512Mi"
      cpu: "250m"
  portsSettings:
    ports:
      - name: http
        port: 8501
        targetPort: 8501
        protocol: TCP
    type: LoadBalancer #ClusterIP
  livenessProbeSettings:
    livenessProbe:
      httpGet:
        path: /_stcore/health
        port: 8501
      initialDelaySeconds: 30
      periodSeconds: 15
      failureThreshold: 3
  readinessProbeSettings:
    readinessProbe:
      httpGet:
        path: /_stcore/health
        port: 8501
      initialDelaySeconds: 10
      periodSeconds: 10
      failureThreshold: 3
